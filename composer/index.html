<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Plant Guild Composer</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width">
	
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/bootstrap-responsive.min.css">
	<link rel="stylesheet" href="css/style.css?old">
	<link rel="stylesheet" href="css/main.css">

	<script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
</head>
<body data-spy="scroll" data-target="#navbar" data-offset="20">
	<!--[if lt IE 7]>
		<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
	<![endif]-->

	<!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

	<div id="navbar" class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</a>
				<a class="brand" href="#">Plant Guild Composer</a>
				<div class="nav-collapse collapse">
					<ul class="nav">
						<li id="menu-welcome"><a href="#welcome-row" onClick="scroll($(this).attr('href'));">Welcome</a></li>
						<li id="menu-map"  style="display:none;"><a href="#map-row" onClick="scroll($(this).attr('href'));">Map</a></li>
						<li id="menu-options"  style="display:none;"><a href="#options-row" onClick="scroll($(this).attr('href'));">Options</a></li>
						<li id="menu-more"  style="display:none;" class="dropdown">
							<a href="#more-row" class="dropdown-toggle" data-toggle="dropdown">More <b class="caret"></b></a>
							<ul class="dropdown-menu">
								<li><a href="#">Action</a></li>
								<li><a href="#">Another action</a></li>
								<li><a href="#">Something else here</a></li>
								<li class="divider"></li>
								<li class="nav-header">Nav header</li>
								<li><a href="#">Separated link</a></li>
								<li><a href="#">One more separated link</a></li>
							</ul>
						</li>
					</ul>
					<!--<form class="navbar-form pull-right">
						<input class="span2" type="text" placeholder="Email">
						<input class="span2" type="password" placeholder="Password">
						<button type="submit" class="btn">Sign in</button>
					</form>-->
				</div><!--/.nav-collapse -->
			</div>
		</div>
	</div>
	
	<!--<header class="jumbotron subhead" id="overview">
		  <div class="inner">
			<div class="container">
			  <h1>Plant Guild Composer</h1>
			  <p class="lead">
				Project by <a href="#" target="_blank">Juliet Norton</a>.
			  </p>
			</div>
		  </div>
	</header>-->

	<div class="container">

		<!-- Main hero unit for a primary marketing message or call to action -->
		
		<div id="welcome-row"class="row">
			<div id="welcome" class="span12">
				<div class="container-item">
					<form class="form-search">
					<h1>Welcome</h1>
					<p class="span3">Enter your location:</p>
					 <div class="input-append span6">
					  <input class="input-xlarge span5" id="location" type="text" placeholder="Street, City, State">
						<button id="current-location" class="btn" type="button" data-trigger"hover" data-toggle="popover" data-content="Click for current Location" data-placement="top"
						data-loading-text="<i class='icon-refresh'></i>">
							<i class="icon-map-marker"></i>
						</button>
					</div>
					<button id="find" class="span1 btn">Find</button>
					</form>
				</div>
			</div>
		</div>
		
		<div id="map-row" class="row">
			<div id="map" style="display:none;">
				<div class="span2">
					<div class="container-item map-item">
					 
						<div id="q1" class="alert alert-success" style="display:none;">Draw the perimeter of your plant guild
						<i class="icon-arrow-right"></i>
						</div>
						
						<div id="composer-icons"  style="display:none;">
							<h4>Key Species</h4>
							<div class="btn-group btn-group-vertical" data-toggle="buttons-radio">
							    <button class="btn" data-category="key" data-size="50" data-name="Avocado Tree"><img src="img/tree.png"><p name="avocado">Avocado Tree</p></button>
							    <button class="btn" data-category="key" data-size="50" data-name="Orange Tree"><img src="img/tree.png"><p name="orange">Orange Tree</p></button>
							    <button class="btn" data-category="key" data-size="50" data-name="Persimmon Tree"><img src="img/tree.png"><p name="persimmon">Persimmon Tree</p></button>
								<h4>Support Species</h4>
								<h5 class="text-info">Nitrogen</h5>
									<button class="btn" data-category="nitrogen" data-size="10" data-name="Watercress"><img src="img/herb.png"><p name="nitrogen">Watercress</p></button>
									<button class="btn" data-category="nitrogen" data-size="10" data-name="Pigeon Peas"><img src="img/shrub.png"><p name="nitrogen">Pigeon Peas</p></button>
									<button class="btn" data-category="nitrogen" data-size="15" data-name="Mexican Sunflower"><img src="img/herb.png"><p name="nitrogen">Mexican Sunflower</p></button>
									<button class="btn" data-category="nitrogen" data-size="15" data-name="Green Bean"><img src="img/understory.png"><p name="nitrogen">Green Bean</p></button>
								<h5 class="text-success">Pest Control</h5>
									<button class="btn" data-category="pests" data-size="15" data-name="Radish"><img src="img/herb.png"><p name="pests">Radish</p></button>
									<button class="btn" data-category="pests" data-size="10" data-name="Comfrey"><img src="img/shrub.png"><p name="pests">Comfrey</p></button>
									<button class="btn" data-category="pests" data-size="15" data-name="Chives"><img src="img/understory.png"><p name="pests">Chives</p></button>
									<button class="btn" data-category="pests" data-size="15" data-name="Lavendar"><img src="img/herb.png"><p name="pests">Lavender</p></button>
								</div>
						</div>
					</div>
				</div>
				<div class="span8" style="height:100%;">
					<div class="container-item">
						<div id="map-canvas" style="height:100%;"></div>
					</div>
				</div>
				<div class="span2">
					<div class="container-item">
						<div id="forecast-dash" class="map-item">
							<h4>Temperature <i class="icon-fire"></i></h4>
							<h2 id="temperature"><span id="value"></span><span class="muted">°F</span></h2>
							<h4>Humidity <i class="icon-tint"></i></h4>
							<h2 id="humidity"><span id="value"></span><span class="muted">%</span></h2>
							<h4>Wind <i class="icon-plane"></i></h4>
							<svg id="wind-bearing" xmlns="http://www.w3.org/2000/svg" version="1.1" width="50" height="50" viewBox="0 0 50 50">>
							  <path d="M25,0 L40,50 L25,35 L10,50 L25,0" />
							</svg>
							<h2 id="wind-speed"><span id="value"></span><span class="muted">mph</span></h2>
							<h6>Powered by <a href="http://forecast.io">Forecast.io</a></h6>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div id="dashboard" class="row"  style="display:none;">
			<div class="span12 container-item">
			
				<div class="span4" id="inspector">
					<h3>Inspector</h3>
					<label class="pull-left text-center">
						<!-- inspector media goes into this label with javascript -->
					</label>
					<div id="more-info" class="media-body">
					
					</div>
				</div>
				<div class="span4">
					<h3>Guild Viability</h3>
					<label class="control-label">Nitrogen Fixation Level</label>
					<div class="progress">
					  <div class="nitrogen-bar bar bar-info" style="width:0%"></div>
					</div>
					<label class="control-label">Pest Control Level</label>
					<div class="progress">
					  <div class="pests-bar bar bar-success" style="width:0%"></div>
					</div>
				</div>
				<div class="span4">
				
				</div>				
			</div>
		</div>
		
		<div id="options-row" class="row">
			<div id="options" style="display:none;">
				<div class="span4">
					<div id="card1" class="container-item">
						<form>
						<p>Is there a building to the south of the guild?</p>
						<div class="btn-group" data-toggle="buttons-radio">
						  <input type="button" class="btn btn-good" value="Yes" />
						  <input type="button" class="btn btn-bad" value="No" />
						</div>
						</form>
					</div>
				</div>
				<div class="span4">
					<div id="card2" class="container-item">
					<div class="container-item">
						<ul id="sortable-species">
							<li class="item">Avocado</li>
							<li class="item">Navel Orange</li>
							<li class="item">Persimmon</li>
						</ul>
					</div>
					</div>
				</div>
				<div class="span4">
					<div id="card2" class="container-item">
						<div class="container-item">
							<ul id="sortable">
								<li class="item">Mexican Sunflower - Dynamic Accumulator</li>
								<li class="item">Lavender - Pollenating</li>
								<li class="item">Strawberry</li>
								<li class="item">Rosemary - Pest</li>
								<li class="item">Pigeon Pea - NF</li>
								<li class="item">Marigold - Pest</li>
								<li class="item">Chard</li>
								<li class="item">Onion - Pest</li>
								<li class="item">Garlic - Pest</li>
								<li class="item">Leek - Pest</li>
								<li class="item">Radish - Pest</li>
								<li class="item">Yarrow - Dynamic Accumulator</li>
								
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div id="more-row"class="row">
			<div id="more"  style="display:none;">
				<div id="card3" class="span4">
					
				</div>
				<div class="span4">
					<div class="container-item">
					Lorem IpsumLorem IpsumLorem IpsumLorem IpsumLorem Ipsum
					</div>
				
				</div>
				<div class="span4">
					<div class="container-item">
					Lorem IpsumLorem IpsumLorem IpsumLorem IpsumLorem Ipsum
					</div>
				</div>
			</div>
		</div>
			

		<hr>

		<footer>
			<p>&copy; Project by Juliet Norton 2013</p>
		</footer>

	</div> <!-- /container -->

	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
	<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
	<script src="js/vendor/bootstrap.min.js"></script>
	<script src="js/plugins.js"></script>
	<script src="js/lib/underscore-min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/1.9.3/TweenMax.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=weather,drawing"></script>
	<script src="js/forecast.io.js"></script>
	<!--<script src="js/main.js"></script>-->
	
	
	
	
	
	
	
	
	
	
	
	
	<script>
	$(document).ready(function(){
	
		//set everything initially to hide. This was slow, so instead I just added style="display:none;" for all the things that needed to be hidden.
		$( "#sortable" ).sortable();
		$( "#sortable" ).disableSelection();
		$( "#map" ).hide();
		$( "#options" ).hide();
		$( "#more" ).hide();
	   	$( "#q1" ).hide();
		$( "#q2" ).hide();
		$( "#menu-map").hide();
		$( "#menu-options").hide();
		$( "#menu-more").hide(); 
		$( "#composer-icons").hide();
		$( "#dashboard" ).hide();
		$( "#map-row div.img").draggable({ opacity: 0.7, helper: "original" });
	   
	   //displays the pop up over the current location button, and 
		$("#current-location").popover({trigger: 'hover', delay: { show: 900, hide: 10 }});
		//click event for current location
	    $("#current-location").click(function (){
	    	  //sets the state of the button to loading.
			  $("#current-location").button("loading");
			  //slide down the map menu for the navigation menu
			  $("#menu-map").slideDown();
			  //after the load event on the window triggers, call the getCurrentLocation function
			  google.maps.event.addDomListener(window, 'load', getCurrentLocation(function(pos){
				  console.log("resetting button");
				  //reset the loading state on the current location button
				  $("#current-location").button("reset");
				  //set the color of the input to blue
				  $("input[name='start-location']").addClass("input-primary");
				  //set the color of the group to blue
				  $("#current-location-group").addClass("info");
				  //change the color of the button to blue
				  $("#current-location").addClass("btn-primary");
				  //change the color of the icon for current location to white
				  $("#current-location i").addClass("icon-white");
				  
				  //console.log("before scroll");
				  console.log(pos);
				  
				  //get the address for the gps location and set that in the location input
				  //the second argument is a callback function that is triggered after the getAddress method is called
				  getAddress(pos, function(data){
				  	console.log(data);
				  	$("#location").val(data);
				  });
				  //refresh the spy scroller, check bootstrap documentation for spy-scroll
				  refreshSpy();
			  }));
		});
	  
		//trigger the onFind event, the search for location button
	  	$('#find').on('click', function(event) {
	  		//prevent the page from reloading
			event.preventDefault();
			//slide the map menu item from the navigation bar down
			$("#menu-map").slideDown();
			//make an address variable with the text from the location input
			var address = $('#location').val();
				//get the gps location for the address from google's geolocation service
				getGPS(address, function(data){
					//log the return data
					console.log(data);
					//slide the map down
					slideMapDown(data);
				});
			//change the drawing tools to include the polygon tool	
			addPolygonDrawing();
			//refresh the spy-scroll, check bootstrap docs
			refreshSpy();
			});
	    
	    //trigger event for selecting plants from the side bar
	  	$('#composer-icons button').click(function(){
	  	
		  //make variables from the composer icons html 
		  //get the source from button's img 
		  var icon_img = $(this).find("img").attr('src');
		  //get the category from data-category
		  var icon_category = $(this).attr("data-category");
		  //get the name from data-name
		  var icon_name = $(this).find("p").attr('name');
		  //get size of icon from data-size
		  var icon_size = $(this).attr("data-size");
		  //set the Drawing Manager to the current plant selected
		  setDrawing(icon_img, icon_category, icon_name, icon_size);
		  //hide the inspector if there is something already showing
		  $('#inspector').hide();
		  //set the inspector to the current button's html
		  $('#inspector label').html($(this).html());
		  $('#inspector label').find('img').addClass("img-polaroid");
		  switch ($(this).find("p").attr('name')){
		  
			  case 'avocado': 
			  		content =  '<h4 class="media-heading">Common Name:</h4> Avocado Tree<h4>Family Name:</h4> Lauraceae <h4>Genus Name:</h4> Persea 	<h4>Species:</h4> Americana 	<h4>Endemic Status:</h4>	Non-Native';
					$('#more-info').html(content);
					break;
			  case 'persimmon':
			  		content = '<h4 class="media-heading">Common Name:</h4> Persimmon Tree<h4>Family Name:</h4> Ebenaceae <h4>Genus Name:</h4> Diospyros	<h4>Species:</h4> Americana <h4>Endemic Status:</h4>	Non-Native';
			  		$('#more-info').html(content);
			  		break;
			  case 'orange':
			  		content = '<h4 class="media-heading">Common Name:</h4> Orange Tree	<h4> Family Name:</h4> Rutaceae	<h4> Genus Name:</h4> Citrus	<h4>Species:</h4> C. × Sinensis	<h4>Endemic Status:</h4>	Non-native';
			  		$('#more-info').html(content);
			  		break;
			  case 'nitrogen':
				  content = '<h4 class="media-heading">Guild Role:</h4> Nitrogen Fixation';
				  $('#more-info').html(content);
				  break;			  
			  case 'pests':
				  content = '<h4 class="media-heading">Guild Role:</h4> Pest Control';
				  $('#more-info').html(content);
				  break;
			  default:
			  		$('#more-info').html(" ");
			  		break;	  			
		  }			  	
		  $('#inspector').slideDown('normal', function(){
		  	$('#more-info').slideDown();
		  });
	  	}); 
	});
	
	
 	var gmap; //global map variable
 	var glat = 33.6431859; //global lat and png values. Set initially to irvine
 	var glng = -117.8413502; //global lat and png values. Set initially to irvine
 	var geocoder; //global geocoder from google's geocoder API
 	var markersArray = new Array(); //array to store markers on map
 	var pixelSizeAtZoom0 = .000001; //the size of a pixel at map-zoom = 0
 	var maxPixelSize = 350; //restricts the maximum size of the icon, otherwise the browser will choke at higher zoom levels trying to scale an image to millions of pixels
 	var conditions; //weather conditions from the forecast.io api
 	var forecast = new ForecastIO(); //Forecast.io API

 	console.log(forecast);
 	google.maps.visualRefresh = true; //show the new Google Maps API as of May 2013
 	
	function initialize() 
	{
		geocoder = new google.maps.Geocoder();
		var pos = new google.maps.LatLng(60, 50);
		mapDiv = document.getElementById('map-canvas');
		
		var mapOptions = {
		    zoom: 20,
		    center: pos,
		    panControl: true,
		    zoomControl: true,
		    scaleControl: true,
		    mapTypeControl: true,
		    streetViewControl: false,
		    overviewMapControl: false,
		    mapTypeId: google.maps.MapTypeId.SATELLITE
		  }
		
		gmap = new google.maps.Map(mapDiv, mapOptions);
		//gmap.setTilt(0);
		drawingManager = new google.maps.drawing.DrawingManager();
		drawingManager.setMap(gmap);			
		
		addPolygonDrawing();
		 /*
		google.maps.event.addListener(drawingManager, 'polygoncomplete', function(polygon) {
				  
		});*/
		
		google.maps.event.addListener(drawingManager, 'overlaycomplete', function(event) {
		  if (event.type == google.maps.drawing.OverlayType.MARKER) {
		    //event.overlay.setTitle("Hello");
		    if(event.overlay.icon == "img/null.png"){
		    	$("#q1").html('Please select a key species <i class="icon-arrow-down"></i>');
		    	$("#q1").slideDown();
		    }
		    else{
			    console.log(event);
			    var icon_midpoint = event.overlay.getIcon().size.height/2;
			    console.log(icon_midpoint);
			    $("#q1").slideUp();
			    var size = $("#composer-icons button.active").attr("data-size");
			    var name = $("#composer-icons button.active").attr("data-name");
			    console.log("size:" + size);
			    addMarker(event.overlay, size, size, name);
			    var infowindow = new google.maps.InfoWindow({
			      content: '<div id="content" onmouseover="updateContent()"><h4>'+ name+'</h4><label class="control-label">Guild Viability</label><div class="progress"><div class="nitrogen-bar-total bar bar-info" style="width:0%"></div><div class="pests-bar-total bar bar-success" style="width:0%"></div></div>',
			      pixelOffset: new google.maps.Size(0, icon_midpoint)
			    });
			    google.maps.event.addListener(event.overlay,'click',function(){
			    	infowindow.open(gmap,event.overlay);
			    	updateProgressBars();
			    });
			}
		  }
		  else if (event.type == google.maps.drawing.OverlayType.POLYGON) {
			  	console.log(event);
			  	event.overlay.setOptions({fillColor: '#000000'});
			   	$('#q1').slideUp(function(){
			   		$('#composer-icons').slideDown(function(){
			   			$('#dashboard').slideDown();
			   		});
			   		removePolygonDrawing();
			   });
		  }
		});
		
		google.maps.event.addListener(gmap, 'zoom_changed', function() {
			console.log("zoom:" + gmap.getZoom());
		    
		    var zoom = gmap.getZoom();
		    var relativePixelSize = pixelSizeAtZoom0*Math.pow(2,zoom); // use 2 to the power of current zoom to calculate relative pixel size.  Base of exponent is 2 because relative size should double every time you zoom in
		
		    /*if(relativePixelSize > maxPixelSize) //restrict the maximum size of the icon
		        relativePixelSize = maxPixelSize;*/
		
		    //change the size of the icon
		    _.each(markersArray, function(value, key, list){
		    	console.log(value.width + "*" + relativePixelSize);
		    	console.log(value.marker.getIcon());
		    	value.marker.setIcon(
		    	    new google.maps.MarkerImage(
		    	        value.marker.getIcon().url, //marker's same icon graphic
		    	        null,//size
		    	        null,//origin
		    	        null, //anchor
		    	        new google.maps.Size(value.width*relativePixelSize, value.height*relativePixelSize) //changes the scale
		    	    )
		    	);   
		    
		    });
		    
		         
		});
			
		var weatherLayer = new google.maps.weather.WeatherLayer({
		 		temperatureUnits: google.maps.weather.TemperatureUnit.FAHRENHEIT
				});
		weatherLayer.setMap(gmap);
			
		var cloudLayer = new google.maps.weather.CloudLayer();
		cloudLayer.setMap(gmap);	
	} 

	google.maps.event.addDomListener(window, 'load', initialize);
	
	function slideMapDown(pos)
	{
		var mapRow = $("#map");
		mapRow.show("normal", function()
		{
			console.log(pos);
			scroll("#map");
			TweenMax.to(mapRow, 1, {
				 height:"400px", ease:Quad.easeOut, onComplete: function()
				 {
					 google.maps.event.trigger(gmap, 'resize');
					 gmap.setZoom( gmap.getZoom() );
					 gmap.setCenter(pos);
					 //gmap.setTilt(0);
					 var marker = new google.maps.Marker({
						 map: gmap,
						 position: pos
					 });
					 $("#q1").slideDown();
					 loadForecast(pos.lat(), pos.lng());
				 }
			});  
		});     
	}
	
	
	function loadForecast(lat, long)
	{
		conditions = forecast.getCurrentConditions(lat, long);
		var temp = conditions.getTemperature();
		var humidity = (Math.round(conditions.getHumidity()*100));
		var wind_speed = conditions.getWindSpeed();
		var wind_bearing = conditions.getWindBearing();
			
		$("#temperature #value").text(temp);
		$("#humidity #value").text(humidity);
		$("#wind-speed #value").text(wind_speed);
		$("#wind-bearing").css("transition","all 1s ease-in-out");
		$("#wind-bearing").css("transform", "rotate("+wind_bearing+"deg)");
		#("#wind-bearing").attr("alt",wind_bearing);

	}
		
	function getGPS(address, output)
	{
	    geocoder.geocode( { 'address': address}, function(results, status) 
	        {
	          if (status == google.maps.GeocoderStatus.OK) 
	          {
	          	console.log(results);
	          	output(results[0].geometry.location);
	          }
	          else 
	          {
	              console.log(status);
	          }
	        }
	    );
	}
		
	function getAddress(location, output)
	{
		console.log(location);
		//glat = location.lat();
		//glng = location.lng();
	    geocoder.geocode( { 'latLng': location }, function(results, status)
	        {
	        	//console.log(status);
	          if (status == google.maps.GeocoderStatus.OK)
	          {
		          	output(results[0].formatted_address);
	          }
	          else
	          {
	          		//console.log(status);
	          }
	        }
	    );
	}
		
	function getCurrentLocation(callback)
	{
		navigator.geolocation.getCurrentPosition(function(position){
			var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
			glat = position.coords.latitude;
			glng = position.coords.longitude;
			slideMapDown(pos);    
			callback(pos);
			console.log(pos);
		}, displayError);
	}
		
	function displayError(error) 
	{
	  var errors = { 
		1: 'Permission denied',
		2: 'Position unavailable',
		3: 'Request timeout'
	  };
	  alert("Error: " + errors[error.code]);
	} 		      
		  
	function setDrawing(icon, title, name, size) 
	{
		var relativePixelSize = pixelSizeAtZoom0*Math.pow(2,gmap.getZoom());
		
		var markerImage = new google.maps.MarkerImage(
		    icon,
		    new google.maps.Size(size*relativePixelSize,size*relativePixelSize), //size
		    null, //origin
		    null, //anchor
		    new google.maps.Size(size*relativePixelSize,size*relativePixelSize) //scale
		);
	
	
		drawingManager.setOptions({
		   drawingMode: google.maps.drawing.OverlayType.MARKER,
		   drawingControl: true,
		   drawingControlOptions: {
			 position: google.maps.ControlPosition.TOP_CENTER,
			 drawingModes: [
			   google.maps.drawing.OverlayType.MARKER,
			   google.maps.drawing.OverlayType.POLYGON,
			 ]
		   },
		   markerOptions: {
			 icon: markerImage,
			 draggable: true,
			 title: title,
			 raiseOnDrag: false
		   }
	 	});
   	}
		   
   	function removePolygonDrawing()
   	{
	   drawingManager.setOptions({
		 drawingMode: google.maps.drawing.OverlayType.MARKER,
		 drawingControl: true,
		 drawingControlOptions: {
		   position: google.maps.ControlPosition.TOP_CENTER,
		   drawingModes: [google.maps.drawing.OverlayType.MARKER]
		 },
		 markerOptions: {
		 	icon: 'img/null.png'
		 }
	   });
   	}
   
   	function addPolygonDrawing()
   	{
	   drawingManager.setOptions({
		 drawingMode: google.maps.drawing.OverlayType.POLYGON,
		 drawingControl: true,
		 drawingControlOptions: {
		   position: google.maps.ControlPosition.TOP_CENTER,
		   drawingModes: [google.maps.drawing.OverlayType.POLYGON]
		 }
	   });
   	}
   	
   	// Removes the overlays from the map, but keeps them in the array
   	function addMarker(marker, width, height, name) {
   	  markersArray.push({'marker': marker, 'width': width, 'height':height, 'name':name});
   	  updateProgressBars();
   	}
						  
	// Removes the overlays from the map, but keeps them in the array
	function clearOverlays() {
	  if (markersArray) {
		for (i in markersArray) {
		  markersArray[i].setMap(null);
		}
	  }
	}
			
	// Shows any overlays currently in the array
	function showOverlays() {
	  if (markersArray) {
		for (i in markersArray) {
		  markersArray[i].setMap(gmap);
		}
	  }
	}
			
	// Deletes all markers in the array by removing references to them
	function deleteOverlays() {
	  if (markersArray) {
		for (i in markersArray) {
		  markersArray[i].setMap(null);
		}
		markersArray.length = 0;
	  }
	}
	
	
	function scroll(id)
	{
		$("html, body").animate({ scrollTop: $(id).offset().top - 75}, 1000);
	}
		
	function refreshSpy()
	{
		$('[data-spy="scroll"]').each(function () {
		  $(this).scrollspy('refresh');
		});
	
	}
 	
 	function updateProgressBars()
 	{
 		var newArray = _.pluck(markersArray, 'marker');
 		key_size = _.size(_.where(newArray, {title: "key"}));
 		n_size = _.size(_.where(newArray, {title: "nitrogen"}));
 		p_size = _.size(_.where(newArray, {title: "pests"}));
 		
 		n_width = (n_size/(key_size*4))*100;
 		p_width = (p_size/(key_size*3))*100;
 		
 		if(n_width > 100)
 			n_width = 100;
 		if(p_width > 100)
 			p_width = 100;
 		$(".nitrogen-bar").css("width", n_width + "%");
 		$(".pests-bar").css("width", p_width + "%");
 		
 		$(".nitrogen-bar-total").css("width", n_width*(4/7) + "%");
 		$(".pests-bar-total").css("width", p_width*(3/7) + "%");
 	
 	}
</script>
   
	
	
	
	
	
	
	
	
	
	
	
</body>
</html>
